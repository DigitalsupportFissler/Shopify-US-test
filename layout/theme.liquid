{%- comment -%}
  ------------------------------------------------------------------------------------------------------------------------
  NOTE TO DEVELOPERS: welcome to Impact theme! We hope that you will enjoy editing this theme as much as we did for
    developing it. We have put a lot of work to make this theme as developer friendly as possible by offering you
    hooks to integrate into critical parts of the theme. You will find the complete technical documentation (including
    all events, dependencies...) in the "documentation.txt" file, located in the Assets folder.
  ------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}

<!doctype html>

<html lang="{{ request.locale.iso_code }}" dir="{% render 'direction' %}">
  <head>
    <meta charset="utf-8">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, maximum-scale=1.0"
    >
    {% render 'dynamic-head-link' %}
    <meta name="theme-color" content="{{ settings.header_background }}">
    <script src="{{ 'redirect.js' | asset_url }}" defer></script>
    <link rel="preload" href="{{ 'SharpGroteskBook19.woff2' | asset_url }}" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{{ 'SharpGroteskMedium19.woff2' | asset_url }}" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{{ 'SharpGroteskBook22.woff2' | asset_url }}" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{{ 'SharpGroteskMedium22.woff2' | asset_url }}" as="font" type="font/woff2" crossorigin>

    <link rel="stylesheet" href="{{ 'fonts.css' | asset_url }}">

    <title>
      {% if page_title == blank -%}
        {{- shop.name -}}
      {%- else -%}
        {{- page_title -}}
        {%- if current_page != 1 %} &ndash; {{ 'general.page' | t: page: current_page }}{% endif -%}
      {%- endif %}
    </title>

    {%- if page_description -%}
      <meta name="description" content="{{ page_description | escape }}">
    {%- endif -%}

    <link rel="canonical" href="{{ canonical_url }}">

    {%- if settings.favicon -%}
      <link rel="shortcut icon" href="{{ settings.favicon | image_url: width: 96 }}">
      <link rel="apple-touch-icon" href="{{ settings.favicon | image_url: width: 180 }}">
    {%- endif -%}

    {%- comment -%}Few prefetch to increase performance on commonly used third-parties{%- endcomment -%}
    <link rel="preconnect" href="https://cdn.shopify.com">
    <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    <link rel="dns-prefetch" href="https://productreviews.shopifycdn.com">

    {%- unless settings.heading_font.system? -%}
      <link rel="preload" href="{{ settings.heading_font | font_url }}" as="font" type="font/woff2" crossorigin>
    {%- endunless -%}

    {%- unless settings.text_font.system? -%}
      <link rel="preload" href="{{ settings.text_font | font_url }}" as="font" type="font/woff2" crossorigin>
    {%- endunless -%}
    <script
      id="usercentrics-cmp"
      src="https://web.cmp.usercentrics.eu/ui/loader.js"
      data-settings-id="ehfl_5pUWkD2p4"
    ></script>

    <!-- Smart Data Protector -->
    <script
      type="application/javascript"
      src="https://privacy-proxy.usercentrics.eu/latest/uc-block.bundle.js"
    ></script>
    <script>
      {% comment %} uc.changeOverlayStyle('single-button'); {% endcomment %}
      uc.reloadOnOptIn('BJz7qNsdj-7'); // YouTube
      uc.reloadOnOptIn('S1pcEj_jZX'); // Google Maps
    </script>
    <!-- END Usercentrics CMP + SDP -->

    {%- render 'social-meta-tags' -%}
    {%- render 'microdata-schema' -%}
    {%- render 'css-variables' -%}
    {%- render 'js-variables' -%}

    <script>
      if (!(HTMLScriptElement.supports && HTMLScriptElement.supports('importmap'))) {
        const importMapPolyfill = document.createElement('script');
        importMapPolyfill.async = true;
        importMapPolyfill.src = "{{ 'es-module-shims.min.js' | asset_url }}";

        document.head.appendChild(importMapPolyfill);
      }
    </script>

    <script type="importmap">
      {%- comment -%}On Safari 16.3 and lower, a polyfill is used to load importmap{%- endcomment -%}
      {
        "imports": {
          "vendor": "{{ 'vendor.min.js' | asset_url }}",
          "theme": "{{ 'theme.js' | asset_url }}",
          "photoswipe": "{{ 'photoswipe.min.js' | asset_url }}"
        }
      }
    </script>

    <script type="module" src="{{ 'vendor.min.js' | asset_url }}"></script>
    <script type="module" src="{{ 'theme.js' | asset_url }}"></script>
    <script type="module" src="{{ 'custom.js' | asset_url }}"></script>

    {{ content_for_header }}

    {{- 'theme.css' | asset_url | stylesheet_tag: preload: true -}}
    {{- 'custom.css' | asset_url | stylesheet_tag: preload: true -}}

    {%- comment -%}
      Robots meta tag from SEO metafields (centralized)
      Supports: pages (page.metafields.seo.robots) and collections (collection.metafields.seo.robots)
    {%- endcomment -%}
    {%- assign robots_value = blank -%}
    {%- if request.page_type == 'page' and page and page.metafields.seo.robots.value != blank -%}
      {%- assign robots_value = page.metafields.seo.robots.value -%}

    {%- elsif request.page_type == 'collection' and collection and collection.metafields.seo.robots.value != blank -%}
      {%- assign robots_value = collection.metafields.seo.robots.value -%}
    {%- endif -%}
    {%- if robots_value != blank -%}
      <meta name="robots" content="{{ robots_value }}">
    {%- endif -%}

    <script src="{{ 'consent-tracking.js' | asset_url }}" defer></script>
  </head>

  <body class="{% if settings.zoom_image_on_hover %}zoom-image--enabled{% endif %}{% if page.handle %} page-{{ page.handle }}{% endif %}">
    {%- comment -%}
      Restore native fetch from a clean iframe.
      This fixes Bazaarvoice helpfulness buttons (thumbs up/down) which break
      when window.fetch is intercepted by consent management or other apps.
      Runs on DOMContentLoaded to ensure it executes AFTER app scripts that intercept fetch.
    {%- endcomment -%}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.setAttribute('aria-hidden', 'true');
        iframe.id = 'native-fetch-iframe';
        document.body.appendChild(iframe);
        var nativeFetch = iframe.contentWindow.fetch.bind(iframe.contentWindow);
        var NativeResponse = iframe.contentWindow.Response;
        window.fetch = nativeFetch;
        window.Response = NativeResponse;
      });
    </script>
    {%- render 'userlike' -%}
    {%- render 'shadow-dom-templates' -%}

    <a href="#main" class="skip-to-content sr-only">{{ 'general.accessibility.skip_to_content' | t }}</a>

    {%- if request.page_type != 'password' -%}
      {%- sections 'header-group' -%}
      {%- sections 'overlay-group' -%}

      {%- if settings.cart_type == 'popover' -%}
        <cart-notification-drawer open-from="bottom" class="quick-buy-drawer drawer"></cart-notification-drawer>
      {%- endif -%}
    {%- endif -%}

    {%- if request.page_type == 'customers/account'
      or request.page_type == 'customers/order'
      or request.page_type == 'customers/addresses'
    -%}
      {%- section 'account-banner' -%}
    {%- endif -%}

    <main role="main" id="main" class="anchor">
      {{ content_for_layout }}

      {%- comment -%}
        IMPLEMENTATION NOTE: due to the very complex logic of margin/padding collapsing in Impact, the footer group is
        added into the main element to ensure that dynamic sections added into the footer group are properly laid out.
      {%- endcomment -%}
      {%- if request.page_type != 'password' -%}
        {%- sections 'footer-group' -%}
      {%- endif -%}
    </main>
    {% render 'swish-swatch-config' %}
  </body>
</html>
