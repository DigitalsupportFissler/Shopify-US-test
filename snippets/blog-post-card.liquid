{%- comment -%}
  ----------------------------------------------------------------------------------------------------------------------
  BLOG POST COMPONENT
  ----------------------------------------------------------------------------------------------------------------------

  Renders a single blog post (optionally highlighted)

  ********************************************
  Supported parameters
  ********************************************

  * article: the article to render. If no article is passed then a placeholder is generated
  * show_excerpt: if set to true, it will show the excerpt first or truncated part of the main content if none is set
  * show_date
  * show_author
  * show_comments_count
  * show_button: if set to true, a button is shown at the bottom of the card
  * show_category: if set to true, the first tag of the article is shown as a category
  * featured: if set to true, the blog post takes the full width with a different layout
  * background: the background to use for the card when the blog post is featured
  * text_color: the text color to use for the card when the blog post is featured
  * sizes: the sizes attribute to show for loading the images
  * position: the position of the card in the list. If specified, the theme will eagerly load the first 3 cards images
{%- endcomment -%}

{%- comment -%}
  Extract the active blog tag from the URL if on a tagged page
{%- endcomment -%}
{%- assign url_parts = canonical_url | split: 'tagged/' -%}
{%- if url_parts.size > 1 -%}
  {%- assign page_tag = url_parts[1] | split: '/' | first -%}
{%- endif -%}

{%- capture card_content -%}
  {%- if article -%}
    {%- if article.image != blank -%}
      {%- liquid
        assign loading_strategy = nil
        
        if section.index > 3 or position > 3
          assign loading_strategy = 'lazy'
        endif
      -%}

      <a
        href="{{ article.url }}{% if page_tag %}?tag={{ page_tag }}{% endif %}"
        class="blog-post-card__figure {% unless featured %}rounded{% endunless %}"
        style="display: block; overflow: hidden;"
      >
        {% comment %} {%- if featured != true and show_category and article.tags.size > 0 -%} {% endcomment %}
        {%- if show_category and article.metafields.custom.category != blank and featured == false -%}
          <span class="badge badge--primary">{{ article.metafields.custom.category.value }}</span>
        {%- endif -%}

        {{- article.image
          | image_url: width: article.image.width
          | image_tag: loading: loading_strategy, sizes: sizes, widths: '300,400,500,600,800,1000,1200,1400,1600,1800,2000', class: 'w-full h-full object-contain zoom-image'
        -}}
      </a>
    {%- endif -%}
  {%- else -%}
    <div class="blog-post-card__figure {% unless featured %}rounded{% endunless %}">
      {{- 'image' | placeholder_svg_tag: 'placeholder zoom-image' -}}
    </div>
  {%- endif -%}

  <div class="blog-post-card__info">
    <div class="v-stack {% if featured %}gap-5 sm:gap-6{% else %}gap-4 sm:gap-5{% endif %}">
      <div class="v-stack gap-3 {% if featured %}sm:gap-5{% else %}sm:gap-4{% endif %}">
        {%- if featured and show_category and article.metafields.custom.category != blank -%}
          <span class="subheading uppercase">{{ article.metafields.custom.category.value }}</span>
        {%- endif -%}

        <h3 class="{% if heading_size != blank %}{{ heading_size }}{% elsif featured %}h2{% else %}h5{% endif %}">
          {%- if article -%}
            {% if show_button %}
              {{ article.title }}
            {% else %}
              <a href="{{ article.url }}{% if page_tag %}?tag={{ page_tag }}{% endif %}">{{ article.title }}</a>
            {% endif %}
          {%- else -%}
            {{- 'general.on_boarding.blog_post_title' | t -}}
          {%- endif -%}
        </h3>

        {%- if show_excerpt -%}
          {%- if article -%}
            <p {% if featured %}class="text-base"{% endif %}>{{ article.excerpt_or_content | strip_html | truncate: 350 }}</p>
          {%- else -%}
            <p {% if featured %}class="text-base"{% endif %}>{{ 'general.on_boarding.blog_post_excerpt' | t }}</p>
          {%- endif -%}
        {%- endif -%}
      </div>

      {%- if show_date or show_author or show_comments_count -%}
        <div class="blog-post-card__meta">


        

          {%- if show_comments_count and article.comments_enabled? -%}
            <div class="text-with-icon link-faded">
              {%- render 'icon' with 'blog-comment' -%}
              <a href="{{ article.url }}#blog-post-comments" class="text-sm">{{ 'blog.comments.count' | t: count: article.comments_count }}</a>
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}

      {%- if show_prep_time or show_recipe_yield or show_author-%}
        <div class="blog-post-card__stats v-stack gap-4 mt-4">
          {%- if show_prep_time and prep_time != blank -%}
            <div class="text-with-icon link-faded">
              {%- render 'icon' with 'timer' -%}
              <span class="text-sm">{{ prep_time }}</span>
            </div>
          {%- endif -%}
          {%- if show_recipe_yield and recipe_yield != blank -%}
            <div class="text-with-icon link-faded">
              {%- render 'icon' with 'cock-dish' -%}
              <span class="text-sm">{{ recipe_yield }}</span>
            </div>
          {%- endif -%}
          {%- if show_author -%}
            <div class="text-with-icon link-faded mt-2" style="margin-left: 3px">
              {%- render 'icon' with 'blog-author' -%}
              <span class="text-sm">{{- article.author | default: 'John D.' -}}</span>
            </div>
          {%- endif -%}
          {%- if show_date -%}
            <div class="text-with-icon link-faded mt-2" style="margin-left: 3px">
              {%- render 'icon' with 'blog-date' -%}
              <span class="text-sm">{{- article.published_at | default: 'now' | date: format: 'abbreviated_date' -}}</span>
            </div>
          {%- endif -%}
        </div>

      {%- endif -%}



      {%- if show_button -%}
        {% assign show_more_text = 'blog.general.show_more' | t %}
        <div>
          {% render 'button', size: "base", class: "text-sm uppercase", content: show_more_text, href: article.url %}
        </div>
      {%- endif -%}
    </div>
  </div>
{%- endcapture -%}

{%- if featured -%}
  <blog-post-card
    {% render 'surface',
      class: 'blog-post-card blog-post-card--featured snap-center group rounded',
      background: background,
      text_color: text_color,
      background_fallback: 'bg-secondary'
    %}
  >
    {{- card_content -}}
  </blog-post-card>
{%- else -%}
  <blog-post-card class="blog-post-card snap-center group">
    {{- card_content -}}
  </blog-post-card>
{%- endif -%}
